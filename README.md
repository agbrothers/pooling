# Robust Noise Attenuation via Adaptive Pooling of Transformer Outputs

This repository contains the code accompanying the research paper `Robust Noise Attenuation via Adaptive Pooling of Transformer Outputs`.

This contains all of the original code used to run the experiments described in the paper. See below for installation instructions and an overall description of the repo. 


## INSTALLATION
Simply navigate to the root directory and run `pip install -e .`

All experiments were run with python 3.11, and the versions of all packages installed during experimentation can be found in requirements.txt if any versioning issues are encountered. The version of ray (`2.37.0`) is particularly important for reproducing the RL experiments, as there may be breaking changes in older and/or more recent versions.


## NEURAL NETWORK CODE
All code relating to neural network components is located in `pooling/pooling/nn` and the single architecture used accross all experiments can be found in `pooling/models/attenuator.py`. All pooling methods are located in `pooling/nn/pooling.py`. All implementations are in PyTorch. 

Wrappers for compatibility and registration with RLlib can be found in `pooling/wrappers`


## RUNNING SUPERVIZED LEARNING EXPERIMENTS
We include a script for generating the synthetic dataset in `data/generate_robustness_dataset.py`. 

To generate a specific input-output pair, run the script with the following arguments:
`python data/generate_robustness_dataset.py --method="knn32" --num_samles=1000000 --num_vectors=128 --dim_vectors=16 --seed=42`

The input dataset X and any targets will be saved in that `data/` directory. Once you have generated targets for knn1 - knn128, you can reproduce the noise robustness experiment via 

`python train/train_supervised.py -p=experiments/noise-robustness`

By default, all configs in the `experiments/noise-robustness` experiment subdirectories are set to train a network with AvgPool. To use alternative pooling methods, you will need to change line 27 manually in each subconfig, such as `experiments/noise-robustness/knn1/config.yml`. 


## RUNNING REINFORCEMENT LEARNING EXPERIMENTS
To run an RL experiment, simply run find the experiment directory you would like to reproduce, such as `simple-tag-1v3v0` and run 

`python train/train_rl.py -p=experiments/simple-tag-1v3v0`


## TRAINING ENVIRONMENTS
We have include the custom simle centroid scenario for the Multi-Particle Environment in `pooling/envs/mpe_centroid.py`. 

We have a local implementation of BoxWorld in `pooling/envs/boxworld.py`, forked from Nathan Grinsztajn's open source implementation (https://github.com/nathangrinsztajn/Box-World). 


## ANALYSIS AND VISUALIZATION
When an RL experiment finishes, a csv summarizing the training results can be generated by running `analysis/summarize_RL.py -p=experiments/simple-tag-1v3v0`. A reward plot can be generated via `analysis/plot_reward.py -p=experiments/simple-tag-1v3v0`.

We have a specific plotting function for the supervised noise robustness experiment. If that experiment has completed for all methods, a plot can be obtained via `analysis/plot_noise_robustness.py -p=experiments/noise-robustness`


## THANK YOU FOR TAKING THE TIME TO REVIEW THE CODE!
